<template>
  <header>
    <nav>
      <li class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" width="200" height="70" fill="#fafa33" viewBox="0 0 1095 348">
          <path d="M1094.58 239.719c-3.89 3.056-8.54 5.487-13.96 7.292-5.41 1.806-10.83 2.709-16.25 2.709-9.44 0-17.71-1.875-24.79-5.626s-12.64-8.959-16.67-15.626c-3.89-6.806-5.83-14.793-5.83-23.96s2.08-17.154 6.25-23.96c4.3-6.806 9.86-12.015 16.67-15.626 6.94-3.751 14.37-5.626 22.29-5.626 6.94 0 13.13.973 18.54 2.917 5.56 1.945 10.28 4.584 14.17 7.917l-9.58 12.501c-2.5-1.944-5.56-3.68-9.17-5.208s-7.71-2.292-12.29-2.292c-5 0-9.66 1.319-13.96 3.958-4.17 2.501-7.5 5.973-10 10.418-2.36 4.445-3.55 9.445-3.55 15.001 0 5.278 1.25 10.209 3.75 14.793 2.51 4.445 5.98 7.987 10.42 10.626 4.45 2.5 9.52 3.75 15.21 3.75 3.75 0 7.15-.556 10.21-1.667 3.2-1.111 6.04-2.639 8.54-4.584l10 12.293zM971.678 161.38h19.377v86.256h-19.377V161.38zm-1.459-31.252c0-3.056 1.181-5.626 3.542-7.709 2.501-2.084 5.209-3.126 8.126-3.126s5.487 1.042 7.709 3.126c2.362 2.083 3.542 4.653 3.542 7.709 0 3.194-1.18 5.833-3.542 7.917-2.222 1.944-4.792 2.917-7.709 2.917s-5.625-1.042-8.126-3.126c-2.361-2.083-3.542-4.653-3.542-7.708zM873.81 161.38l1.667 21.043-.833-3.333c2.777-6.39 7.292-11.46 13.542-15.21 6.251-3.889 13.473-5.834 21.668-5.834s14.862 2.431 20.002 7.292c5.278 4.723 7.986 10.904 8.125 18.544v63.754h-19.585v-56.879c-.138-4.723-1.527-8.542-4.166-11.459-2.501-3.056-6.459-4.584-11.876-4.584-5.001 0-9.515 1.389-13.543 4.167s-7.223 6.598-9.584 11.459c-2.222 4.862-3.333 10.487-3.333 16.877v40.419h-19.377V161.38h17.293zm-138.326 42.295c0-8.612 2.014-16.39 6.042-23.335 4.167-6.945 9.862-12.432 17.085-16.46s15.417-6.042 24.585-6.042c9.445 0 17.709 2.014 24.793 6.042s12.57 9.515 16.459 16.46 5.834 14.723 5.834 23.335-1.945 16.459-5.834 23.543c-3.889 6.945-9.445 12.432-16.667 16.46-7.084 4.028-15.349 6.042-24.794 6.042-9.167 0-17.362-1.875-24.585-5.626-7.083-3.889-12.709-9.236-16.876-16.042-4.028-6.945-6.042-15.071-6.042-24.377zm19.376.208c0 5.556 1.25 10.626 3.751 15.21 2.5 4.444 5.833 7.986 10 10.625 4.306 2.639 9.029 3.959 14.168 3.959 5.417 0 10.209-1.32 14.376-3.959 4.306-2.639 7.639-6.181 10.001-10.625 2.361-4.584 3.541-9.654 3.541-15.21s-1.18-10.556-3.541-15.001c-2.362-4.584-5.695-8.195-10.001-10.834-4.167-2.778-8.959-4.167-14.376-4.167-5.278 0-10.07 1.389-14.376 4.167-4.167 2.778-7.501 6.459-10.001 11.042-2.361 4.445-3.542 9.376-3.542 14.793zM588.35 161.38l1.667 19.376-.833-1.666c3.194-6.529 7.709-11.668 13.542-15.418 5.973-3.751 12.779-5.626 20.418-5.626 4.862 0 9.168.764 12.918 2.292s6.806 3.75 9.167 6.667c2.5 2.778 4.098 6.251 4.792 10.418l-1.042.625c3.334-6.251 7.918-11.112 13.751-14.585 5.973-3.611 12.223-5.417 18.751-5.417 8.473 0 15.14 2.431 20.002 7.292 5 4.723 7.57 10.904 7.709 18.544v63.754h-19.377v-56.879c-.139-4.445-1.25-8.126-3.333-11.042-1.945-3.056-5.417-4.723-10.418-5.001-5 0-9.514 1.528-13.542 4.584-3.889 3.056-6.945 7.014-9.167 11.876-2.223 4.722-3.403 9.862-3.542 15.418v41.044h-19.377v-56.879c-.138-4.445-1.319-8.126-3.541-11.042-2.084-3.056-5.626-4.723-10.626-5.001-5.139 0-9.654 1.528-13.543 4.584s-6.945 7.014-9.167 11.876c-2.083 4.861-3.125 10.07-3.125 15.626v40.836h-19.377V161.38h17.293zm-85.533 88.34c-9.861 0-18.334-1.945-25.418-5.834-7.084-4.028-12.57-9.445-16.459-16.251-3.751-6.945-5.626-14.862-5.626-23.752 0-8.473 2.153-16.182 6.459-23.127s10.07-12.501 17.293-16.668 15.279-6.25 24.168-6.25c11.39 0 20.835 3.333 28.335 10.001s12.571 15.834 15.21 27.502l-71.047 25.002-4.583-11.46 58.337-21.251-4.167 2.708c-1.667-4.583-4.445-8.542-8.334-11.876-3.889-3.472-8.959-5.208-15.209-5.208-5.279 0-10.001 1.319-14.168 3.958-4.167 2.501-7.431 5.973-9.792 10.418s-3.542 9.514-3.542 15.209c0 5.973 1.25 11.251 3.75 15.835a28.82 28.82 0 0 0 10.209 10.626c4.445 2.5 9.445 3.75 15.001 3.75 3.75 0 7.362-.695 10.834-2.084 3.611-1.389 6.945-3.194 10.001-5.417l8.959 14.376c-4.306 2.917-9.168 5.279-14.585 7.084-5.278 1.806-10.486 2.709-15.626 2.709zM338 97h20.21v131.26h76.463v19.376H338V97zM128.535 229.036c3.588 1.398 3.798-4.892 3.798-113.778V0h47.8l-6.04 10.009c-6.331 10.49-9.676 22.51-9.676 34.763v101.181l-.593 140.828a20 20 0 0 1-2.505 9.607l-3.893 7.029c-16.067 29-50.537 45.552-90.479 43.445-29.7-1.567-52.095-14.357-61.864-35.335-8.774-18.844-6.177-37.383 7.698-54.937 24.939-31.549 74.953-43.455 115.754-27.554zM269.59 83.13c.076-.002 2.442 2.355 5.257 5.237l5.119 5.241-.845.772c-4.259 3.888-7.09 6.109-10.613 8.327-17.026 10.72-38.22 13.096-57.257 6.419-19.251-6.753-34.302-22.075-40.753-41.487-6.436-19.365-3.596-40.703 7.652-57.499 2.015-3.009 3.469-4.866 6.083-7.771L186.363 0l10.483 10.471-1.279.127c-1.519.151-3.394.962-4.529 1.96-.862.756-2.694 3.241-4.312 5.848-4.077 6.568-7.361 16.351-7.404 22.056-.014 1.935.054 2.355.558 3.428.315.673.89 1.583 1.276 2.023l.702.8-.67.763c-.369.42-.943 1.345-1.276 2.057-.533 1.139-.604 1.544-.589 3.388.035 4.373 2.172 11.887 5.049 17.753 1.798 3.665 4.75 8.277 6.292 9.828 1.251 1.258 3.206 2.203 4.873 2.354l1.269.115.153 1.129c.486 3.582 2.253 5.546 8.261 9.18 5.557 3.361 12.364 5.877 18.833 6.963 3.882.651 6.264.176 8.365-1.668.722-.634.763-.643 1.116-.253 1.006 1.112 3.994 2.227 5.98 2.231 3.258.007 11.035-2.068 15.807-4.217 4.591-2.067 10.294-5.627 11.894-7.426 1.174-1.32 2.018-3.141 2.141-4.619.053-.637.158-1.159.234-1.161zm-28.753-25.152c1.465.852 23.11 22.528 23.578 23.612.184.425.338 1.223.342 1.775.015 1.632-.785 2.607-3.776 4.605-6.108 4.08-12.889 6.751-20.173 7.947-1.846.303-3.007.079-4.025-.777-.195-.164-.362-.296-.505-.45-.888-.958-.856-2.771-.797-18.282.062-16.054.071-16.333.524-17.201 1-1.917 2.843-2.386 4.832-1.229zm-11.632-.023c.364.26.868.896 1.119 1.414.449.925.457 1.22.468 17.39l.011 16.449-.508.96c-.347.656-.818 1.127-1.489 1.488-.861.464-1.169.512-2.525.398-2.751-.233-7.203-1.351-10.801-2.713-5.872-2.223-12.609-6.353-13.557-8.311-.512-1.056-.553-1.624-.212-2.89.203-.753 1.934-2.584 11.852-12.53l12.259-11.988c.849-.449 2.515-.286 3.383.332zm-18.34-30.364c8.261 8.306 11.109 11.302 11.291 11.879.346 1.094.189 2.788-.324 3.49-.237.325-.821.789-1.299 1.031-.845.429-1.304.441-17.298.441-15.158 0-16.931.059-17.838-.798-.182-.172-.329-.381-.543-.634-.924-1.098-1.071-2.03-.678-4.301 1.393-8.047 4.136-14.663 8.732-21.068 1.78-2.479 3.88-3.111 5.928-1.783.539.35 5.952 5.634 12.029 11.743zm9.744 22.012c.519.297 1.137.843 1.375 1.213.524.818.566 2.253.098 3.381-.234.563-3.806 4.292-11.413 11.912l-11.803 11.549c-1.595.997-3.346.936-4.651-.163-1.047-.881-4.014-5.512-5.591-8.727-2.248-4.582-3.823-9.513-4.588-14.357-.237-1.502-.224-1.827.106-2.691.413-1.081 1.564-2.226 2.501-2.489.332-.093 7.897-.169 16.812-.169h16.21l.944.54z" />
        </svg>

      </li>
      <li class="global_search">
        <input
          type="text"
          id="search-input"
          placeholder="Search..."
          @input="handleInput" />
        <ul class="autocomplete-results" v-show="showAutocomplete">
          <li v-for="result in autocompleteResults" @click="selectResult(result)" :key="result.id">
            <img :src=result.cover>
            <div>{{ result.name }}</div>
          </li>
        </ul>
      </li>
      <li class="setting">
        <button>
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:v="https://vecta.io/nano" width="32" height="32" fill="none" stroke-miterlimit="10" stroke-linejoin="round">
            <path d="M2.667 17.173v-2.347A2.54 2.54 0 0 1 5.2 12.293c2.413 0 3.4-1.707 2.187-3.8-.693-1.2-.28-2.76.933-3.453l2.307-1.32c1.053-.627 2.413-.253 3.04.8l.147.253c1.2 2.093 3.173 2.093 4.387 0l.147-.253c.627-1.053 1.987-1.427 3.04-.8l2.307 1.32c1.213.693 1.627 2.253.933 3.453-1.213 2.093-.227 3.8 2.187 3.8a2.54 2.54 0 0 1 2.533 2.533v2.347a2.54 2.54 0 0 1-2.533 2.533c-2.413 0-3.4 1.707-2.187 3.8a2.53 2.53 0 0 1-.933 3.453l-2.307 1.32c-1.053.627-2.413.253-3.04-.8l-.147-.253c-1.2-2.093-3.173-2.093-4.387 0l-.147.253c-.627 1.053-1.987 1.427-3.04.8L8.32 26.96c-1.213-.693-1.627-2.253-.933-3.453 1.213-2.093.227-3.8-2.187-3.8a2.54 2.54 0 0 1-2.533-2.533z" fill="#171717" stroke="#171717" />
            <path d="M16 20a4 4 0 1 0 0-8 4 4 0 1 0 0 8z" fill="#fafa33" stroke="#fafa33" />
          </svg>
          <span>Setting</span>
        </button>
      </li>
    </nav>
  </header>
</template>

<script>
import { inject, ref } from 'vue';

export default {
  setup() {
    const store = inject('store');

    const showAutocomplete = ref(false);
    const autocompleteResults = ref([]);
    let timeout = null;

    const handleInput = (event) => {
      clearTimeout(timeout);
      const inputValue = event.target.value;
      showAutocomplete.value = inputValue.length;

      // Set a new timeout to trigger the API request after 300ms of inactivity
      timeout = setTimeout(() => {
        getAutocompleteResults(inputValue);
      }, 300);
    };

    const getAutocompleteResults = async (query) => {
      if (query) {
        getSearchSong(query);
      } else {
        autocompleteResults.value = [];
        showAutocomplete.value = false;
      }
    };

    const getSearchSong = async (query) => {
      const response = await fetch(`https://api.spotify.com/v1/search?q=${query}&type=album,track`, {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`,
          'Content-Type': 'application/json',
        },
      });

      if (response.status === 200) {
        const data = await response.json();
        console.log(data);
        autocompleteResults.value = data.tracks.items.map(item => {
          return {
            id: item.id,
            duration_ms: item.duration_ms,
            name: item.name,
            cover: item.album.images[0].url,
          };
        });
        showAutocomplete.value = true;
      } else {
        console.error('Error fetching autocomplete results:', response.statusText);
        showAutocomplete.value = false;
      }
    };

    const selectResult = (result) => {
      showAutocomplete.value = false;
      store.setTrack(result);
    };

    return {
      showAutocomplete,
      autocompleteResults,
      handleInput,
      selectResult,
    };
  },
};
</script>

<style scoped>
header {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;

  & .logo {
    padding: 15px 30px;
    background: #171717;
    font-size: 0;

    @media screen and (max-width:767px) {
      width: 100%;
      text-align: center;
    }
  }
}

nav {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;

  @media screen and (max-width:767px) {
    gap: 0;
  }
}

li {
  list-style: none;
  letter-spacing: 1px;
  font-weight: 700;

  &.setting {

    margin-left: auto;
    margin-right: 20px;

    @media screen and (max-width:767px) {
      margin: 0;
    }

    & button {
      border-radius: 5px;
      background: #FAFA33;
      border: 0;
      width: 175px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      font-weight: 500;
      font-size: 14px;

      @media screen and (max-width:767px) {
        width: auto;
        padding: 15px;

        & span {
          display: none;
        }
      }
    }

  }
}



.global_search {
  flex: 0 0 200px;
  position: relative;

  @media screen and (max-width:767px) {
    flex: 0 0 calc(100% - 80px);
    padding: 15px;
  }

  & input {
    width: 100%;
    padding: 14px 28px;
    border-radius: 5px;
    border: 1px solid rgba(211, 211, 211, 0.20);
    background: #232323;
    color: rgba(255, 255, 255, 0.50);
    font-size: 14px;
    font-weight: 400;
    letter-spacing: -0.408px;
  }

  .autocomplete-results {
    list-style-type: none;
    padding: 0;
    margin: 0;
    background-color: #fff;
    position: absolute;
    border: 1px solid #ccc;
    z-index: 1000;
    width: 100%;
  }

  .autocomplete-results li {
    padding: 5px;
    cursor: pointer;
    font-size: 15px;
    border: 1px solid #eee;
    display: flex;
    align-items: center;
    gap: 10px;

    & img {
      width: 50px;
    }
  }

  .autocomplete-results li:hover {
    background-color: #ccc;
  }
}</style>
